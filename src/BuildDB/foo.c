#include <stdio.h>
#define CAN_LEV 20
#define CAN_ROW 15
#define CAN_COL 66

#include "foo.out"

char canned[CAN_LEV * CAN_ROW][CAN_COL] = {
"           #  .        #                 #     #     #     #   . #",
"           D           D  .                       .        D .   #",
"##D##########################################  #     #     ###D###",
"          -#                 #.    #      # ################ .  .#",
"     ####### ######## ############ D #### #                #     #",
" ... #.#   # #  # . # #            # #### # ############ # ###D###",
"     #.# # # ## #   # # ############ #### # #-  #      # # #.    #",
"  .  # # # # ## #-  # # #    -     D #### # # . D    # #.# # ... #",
"     # #.# #    #   # # #   . .    # #    # #   #    # #-# # ~.! #",
"##D### ### #######D## # ############ ###### ########## ### #######",
"                    #            .#        #      .....       ...#",
"##D###########################################################D###",
"  .  #.....#     #     #     #    -#     #     #     #     #     #",
"      .....    .       D           D                 D     D.    #",
"     #.....#     #     #     #     #     #    .#     #     #     #",
//
" #             . - .                          .             .    #",
" #D############################################################ .#",
" # #       .                          -                     . # ##",
".#.#D#######################################################  #. #",
" # # #   .                     .              .            #  ##-#",
" #-# #D################################################### #  # .#",
" # # # # .     # -     #       #  .   -#  .    #.......#!# #  # ##",
" # # # # ### ### ### ###.### ### ### ### ### ###.###.###~# #  #. #",
".# # # .   # .  .  #    .  #    -  # . .   #   ....#.....# #  ## #",
" #.# ##################################################### #  # .#",
" # #                            ..            .            #. #-##",
" # #########################################################  #. #",
" #        ..     -                      .         .       . . ## #",
"-##############################################################  #",
".                                                              . #",
//
"##   #    ##  #...#           .  . .  .     #  #  #  ##       .###",
" ##     #  ##   #   ####################### #  #.   ##  #####D#D #",
" D########  ##  #####   #    D D      #   # #  #   ##  ## -..##  #",
" # ##..- #   ##     #   #   ## ##  .  # # # #  #  ###  ###  ###  #",
" #  ##-..#    ## .  ##  #  ##-. ## .  # # # #    ## #  #-.-## #  #",
" #   ## -##### ##   #  .  ## . - ##   # # # #   ##  #  #..##  #  #",
".#### ##D##-.#  ##  #  . ## .....-##  # # # #..##  -#### ##   #  #",
" #  # DD ##-.D   ## # ..######D###### # # # #.DD  ###  D##  ###  #",
" #.## ## #####  ## ###    #  #D#   #    #   #..##   #    ##...#  #",
" #.# ##..##    ##  #    #   ##.##    ########   ##  ##  ####..#  #",
"-#. ##...##   ##.  ###### ### .-##    #  -  #    ##  ##    ## #  #",
" # ##..#.##  ##. ###  # # ##.-. .##   #   ######  ##  ####  ##D. #",
" ### #####  ##         .###!. . .~##.   ##  #      ##  ##   -##  #",
" ## ##     ############ #####################  ###  ##  ####  ## #",
"##     #   D    . .    .      -             ..       ##.....  ####",
//
".  #   #      #   .            #     #  #       ##    ####    .. #",
" # # # ###### #  #    .       . .  #      . #      .#  . ##.  .. #",
" #.  #  .     .  #  # . #     #D######################## #D##  - #",
" #################    #      ##.## . .                   #..##   #",
" #     .#   .    #   ###    ##. .##  #####################   ##  #",
" #  -  .D   . -  #  # - #  ##  #  ##   #.  #   #   #   #   ## ## #",
" ########  ..    #        ##  ###  ##  # # # # # # # # #   ##  ###",
" D.              #       ##  ##!##  ##   # # # # # # # #     .. ##",
" ################# .    ##  ##.~.##  ##### # # # # # # ##### ... #",
" D.     #      . #     ##. ## .#. ##  ## ..# # #.# # #.#    . -. #",
" # .- . #.    -  #    ##  ## ..#.. ##  ##  # # #-# # # #    ######",
" #      D.       #   ##  ##  #####- ##  ##   # # # # # #  #.#    #",
" ##############D##  ##  ## .. ... .. ##  ##### #.# # # ## #   - ##",
" #.     .        # ##  ########D########  ## . # # # # #  # #  . #",
" #     -       . ###     -    . .          ##.   #   #   #### #  #",
//
" # .- . #.    -  #    ##  ## ..#.  ##  ##  # # #-# # # #    ######",
" #      D.       #   ##  ##  #####- ##  ## .   # # # # #  #.#    #",
" ##############D##  ##  ## .      .. ##  ##### #.# # # ## #   - ##",
".  #   #      #   .            ##### #  #        #    ####    .. #",
" #D# # ###### #  #    .       . .  #      . #      .#  . ##.  .. #",
" #.  #  .     .  #  # . #     #D########################  D##  - #",
" ################# .    ##  ##. .##  ##### # # # # # # ##### ... #",
" D.     #      . #     ##. ## .#. ##  ## ..# # #.# # #.#    . -. #",
" #.     .        # ##  ########D########  ## . # # # # #  # #  . #",
" #################    #      ##.## . .                   #..##   #",
" #     .#   .    #  ####    ##. .##DD#####################   ##  #",
" #  -  .D   . -  #  # -##  ##  #  ##   #.  #   #   #.  #   ## ## #",
" ########  ..    #  #  #  ## .### .##  # # # # # # # # #   ##  ###",
" D.              #     # ##  ##!##  ##   #   # # # # # #     .. ##",
" #     -       . ###    -## . .~. . ##     ###.  #   #   #### #  #",
//
".. .                   D  #                .  #              #-  #",
"############ ######### # ## ### ##### ## #### ###### ####### ### #",
".#!#~# #   #       .-# # #-   #    #   # # -# #      #           #",
" # #.#  .  #   ####### # #    #    #   # #  # #      #       #####",
" # ..# #####   #     # # #### #    ## ## ## # ###### ####### #   #",
" - ..D #   D   #   . D # #  # #.##### ## ## # #. #.# #..#  # ### #",
"###### ####### ###   # # #    # #      # D  # D  D   #..D  #     #",
"-                #   # # #### # ###### # ## # #. #   #..#    #####",
"## #######################- # # #    ######################  #   #",
"   ...       #   . #     #..# ###    #   - ..  .          #. ### #",
" ########    #     #     #  # ###    #################### #  #   #",
"        #                     ###                                #",
"################################################################ #",
"-     #             #    D    ###    #          #            #   #",
"  .         #            #            #                   #  D   #",
//
"  ..                                                             #",
" ############## ############################################## # #",
"         #    # #                                #     ..    # # #",
"         #D## # # ############D################# ########### # # #",
"######## #- # # # #-    D    # # ~  #          # #         # # # #",
"       # #  # # # #   ### #  # #    D   -      # # ####### # # # #",
"  .... # #### # # #   #!# #  # ######      ..  #.# #     # # # # #",
"  .... #      # # # ### # #  # #    #########D#### # ### # # # # #",
"  .... ######## # # D   # #- # #..  #       ...#.# # #.# # # # # #",
"       #        # ###   # #### #.-  D   -      #.# #.#.# # # # # #",
"####DD## ######## #     #    D D.   #          # # #...# # # # # #",
" #   ..# #    # # ############################## # ##### # # # # #",
" ......# #  #   #                                #       # # # # #",
" ####### ###### ################################ ######### # ### #",
"               .D.                                         #     #",
//
"                  ##        ##            ###                ##  #",
"  #####            ## ..-  ##            ##.##              ##   #",
"  # ! ##            ## .  ##            ##  .##    ..      ##    #",
"  #....######        ##  ##            ##  .  ##          ##     #",
"  # -  #    ##        ##D#            ##  .    ##        ##      #",
"  #####D  ~  ####### ###........     ## ...     ##      ##       #",
"  #    #     ##        ##   ....    ##  .        ##    ##        #",
"  #.   ########         ##         ##   .     -  ####D####   -   #",
"  #.-  #...## ##   ...   ##        ###  ......  ##       ##      #",
"  #.   #..##   ##         #########  ##    ... ##   ###   ## ..  #",
"  #..  #.##     ## ## -  ##  .  ####  ##      ##   #####   ##    #",
"  #####D##          ##  ##     ######  ##    ##   #######   ##   #",
"  D  -.##            ####     ########  ##DD##    ########   #D  #",
"  ######   ...        ##     ##########                       ## #",
"###                                                 .     .    ###",
//
"                                                                 #",
"     ####.########################################## ## ##########",
"     #      #.#.#.#                   #.. #.   #           #     #",
"######    # # # # #       #####       #!  #    ########### # ### #",
"     #    # # # # #      ##...##      #   #    #         # # #-# #",
" ..- D    # # # # #     ## .   ##     ####D#####  .. ### #   # # #",
"     #    #       #    ##.   ~ .##    #   #    ###   # # ##### # #",
"########### # # # #   ##  . .   .##   #...# .. #.#   # #       # #",
"  ..     .# # # # #   ##     -   ##   #   #    D.D   # ######### #",
"      .   D # # # #    ##.......##    ####D#####.#   #           #",
"   - .    # # # # #     ##     ##     # . #    ###   ########### #",
"########### #.#.# #      ###D###      # . #....#               # #",
"            # #-# D               ..  #  .#    ###....##  ##-### #",
"###   ########################################## ######    ###   #",
"         .                                                       #",
//
"                                                                 #",
"                        ###########################D#######  ##  #",
"  #######################                    # ##...... ##   ##  #",
"                        ########D######  #   # !##.... ##    ##  #",
"   ############    ##  ##    ...      #  #   #...## ~ ## ######  #",
"   #          #    #    # ......      #  #   # .. #####      ##  #",
"   #    - ..  #    #    #   ###########  #   #  .  ######### ##  #",
"   #####  #####    #    #   #            #   #...   ##       ##  #",
"       #  #        ##########  ########  ########DD#### #######  #",
"       #  #  ....  #        #  #             #     #  ##     ##  #",
"   #####  #        #    ....#  #  #########  #     #   ##### ##  #",
"   #-    ######D##########..#  #  #########  #  -  #..  ##   ##  #",
"   #####  #                 #  #             #...  #.....##      #",
"       #  ###################  ###############...  ####   # ######",
"       #                                                         #",
//
"                                                                 #",
"########## #####      #####     #####D####    #####       ###### #",
"..       # #-..D ######   ##    # ##     #   ## ..##    ### #### #",
"  #### ### ##### #         ##   #  ##### #  ## ### ##   #   #    #",
"  #  # #       # # ##### #  ##  #      # ####  # #..##### - ###  #",
"  #  # ####### ### #...# #   ########  #       # #~.   ....   #  #",
"  #  #       #     #...# #          #  ######### ##############  #",
"  #  ######  #######   # ###   ###  #       ..                #  #",
"  #       #          - # #-#####!#  # #      ####  ## ####    #  #",
"  ######  #   ########## #.. ....#  # ########  #  #  #  ##   ## #",
"     -.#  #####          ####...##  #    .  .#  #..#  #   ##   # #",
"    ####        ######      #.###   #####.####  ####  ###  ##  # #",
"    #-    #######....####   ......      #.#       .     #   ## # #",
"    #######             ##### ###########.###############    ### #",
"                                         .                       #",
//
"   #     #-   .      #   # # # # # #   #                         #",
" # #     #####.##### # # # # # # # # # # ###########D########### #",
" # #####     # # ### # # # # # # # # # ###     #....    #  #   # #",
" #     #     #       # # # # # # # # # #       #.!. -.. #.##.# # #",
" # . - #     # ####### # # # # # # # # #       ########## ## #   #",
".#######     #         #       D     #        .              # # #",
".     -#     ################################################### #",
"   #####     D.                                             .    #",
"  #         ###  ###D### ### ### ###D### ### ### ###D### ###.### #",
"  # ######  ### .#    .# #.    # #     # #     # #     # # .   # #",
"  ### # -#  ### .#. - .# #     # #...- # # ..  # #  -..# # .   # #",
"      #  #  ###  #. ~ .# #     # #     # #     # # .. .# #     # #",
".######  #  ###  #     # #.....# #     # #     # #     # #     # #",
" #      #######  ####### ####### ####### ####### ####### ####### #",
" # ...                                       ..                  #",
//
"           #  .        #     ###         #     #     #     #   . #",
"           D           D  .        #              .        D .   #",
"############################################## #     #     ###D###",
"          -#                 #.    #      # ################ .  .#",
"     #######D######## ############ # #### #                #     #",
" ... #.    # #!~  . # #            # #--# # ############ #####D###",
"     #.# # # ## #   # # ############ #--# # #-  #      # # #.    #",
"  .  # #-# # ## #-  # # #    -     D ## # # # . D #### #.# # ... #",
"     # #-# #    #   # # #   . .    # #    # #   #    # #-# # -.- #",
"##D### ### ####### ## # ############ ###### ########## ### ###D###",
"                    #             .               .....       ...#",
"####################################         # ###############D###",
"  .  #.....#     #     #     #    -########### #     #     #     #",
"      .....    .       D           D         #       D     D.    #",
"     #.....#     #     #     #     #          .#     #     #     #",
//
".. .       #           D                   .                 #-  #",
"## ######### ######### # ## ### ##### ## ########### ####### ### #",
".# #   #   #       .-# # #-   #    #   # # -# #      #           #",
" # #.#  .  #   ####### # #    #    #   # #  # #      #       #####",
" # ..#######   #     # # #### #    ## ## ##!# ###### ####### #   #",
" - ..D #   D   #   . D # #  # #.##### ## ## # #. #.# #..#  # ### #",
"###### ####### ###   # # #    # #      # D  # D  D   #..D  #     #",
"-                #   # # #### # ###### # ## # #. #   #..#    #####",
"## #######################- # # #    ######################  #   #",
"   ...       #   .       #..# ###    #   - ..  .          #. ### #",
"             #           #  # #-#    #################### #  #   #",
"                         #      #                                #",
"###############################-################################ #",
"-.....             # ####D    ###    #          #            #   #",
"~.....              #    #            #                   #  D   #",
//
"  ..                                                             #",
" ############## ############################################## # #",
"         #    # #                                #     ..    # # #",
"         #D## # # ############D################# ########### # # #",
"######## #- # # # #-    D    # #.!..#          # #         # # # #",
"   #   # #  # # # #   ### ## # #....D   -      # # ####### # # # #",
"  .... # #### # # #   #~# #  # ######      ..  #.# #     # # # # #",
"##....##      # # # ###.# #  #      #########D## # # ### # # # # #",
"  .... ######## # # D  .# #- #  ..  #       ...#.# # #.# # # # # #",
"   #  ##        # ###  .# ####  .-  D   -      #.# #.#.# # # # # #",
"####DD## ######## #... .#       .   #          # # #.#.  # # # # #",
" #   ..# #      # ############################## # # ##### # # # #",
" ......# #  # # #                                # #       # # # #",
" ####### ###### ################################D# ######### ### #",
"               .D.                                           #-.-#",
//
"                  ##        ##         ##        ##          ##  #",
"  ##############   ## ..-  ##          ##  .     ##         ##   #",
"  #    #       ##   ## .  ##           ##   .    ##..      ##    #",
"  #....######   ##   ##  ######## #######  .     ##       ##     #",
"  # -  #    ##   ##   ##D#            ##  .      ##      ##      #",
"  #          D###### ###........     ## ...      ##     ######   #",
"  #    #     ##        ##   ....    ##  .        ##    ##  - #   #",
"  #.   ########         ##         ##   .     -  ####D####.. D   #",
"  #.-  #...## ##   ...   ##        ###  ......  ##       #####   #",
"  #.   #..##   ##         #########  ##    ... ##   ###   ## ..  #",
"  #..  #.##     ## ## -  ##  .  ####  ##      ##   #####   ##    #",
"  #####D#######  #  ##  ##     ##..##  ##    ##   ##   ##   ##   #",
"  D  -.##     #  #   ####     ##.-.-##  ##DD##    ### ####   ##  #",
"  ######.  ...# ####  ##     #### #####                ##     ##D#",
"###~!....     D                                     .     .      #",
//
"                                                                 #",
"     ####.########################################## ## ##########",
"     #      #.#.#.#                   #..  .   #           #     #",
"######    # # # # #   #############   #        ########### # ### #",
"     #    # # # # #    --##...##--    #        #         # # #-# #",
" ..- D    # # # # #   #-## .   ##-#   ####D#####  .. ### #   # # #",
"     #    #       #   ###.     .###   # ~ #    ###   ### ##### # #",
"########### # # # #   ##  . .   .##   #...# .. #.#             # #",
"  ..     .# # # # #   ##     -   ##   #   #    D.    # ######### #",
"      .   D # # # #   ###.......###   ####D#####.#   #           #",
"   - .    # # # # #    -##     ##-    # .      ###   ########### #",
"########### #.#.# #   ######D######   # .  ....#               # #",
"            #!#-# #               ..  #  .     ###....##  ##-### #",
"###   ##############################  ########## ######    ###   #",
"  D      .                                                       #",
//
"                                                                 #",
"                        ###############D####################D#   #",
"  #######################                    # ##......      #   #",
"                        ########D######  #   #  ##....       #   #",
"   ############### ##  ##    ...      #  #   #...##      #####   #",
"   #    ~        # #    #!......      #  #   # .. #####      #   #",
"   #    - ..     # #    #   ###########  #   #  .  ######### #   #",
"   #####  ######## #    #   #         #  #   #...   ##       #   #",
"    .  #  #      # ##########  ########  ########D #### ######   #",
"    .  #  #  ....# #        #  #             #     #  ##     #   #",
"   #####  # ###### #    ....#  #  #########  #     #   #####D#   #",
"   #-    ## #      #######..#  #  #########  #  -  #..           #",
"   #####  #                 #  #             #...  #.....        #",
"       #  ###################  ###############...  ####     ######",
"       #                                                         #",
//
"                      #                                          #",
"########## #####      #         #####D####    #####       ###### #",
"..       # #~..D ######   ##    # ##     #   ## ..##    ### #### #",
"  #### ### ##### #         ##   #  ##### #  ## ### ##   #   #    #",
"  #  # #       # # ##### #  ##  #      # ####  # #..##### - ###  #",
"  #  # ####### ### #...# #   ########  #       # #!.   ....   #  #",
"  #  #       #     #...# #          #  ######### ##############  #",
"  #  ######  #######   # ###   ###  #       ..                #  #",
"  #       #          - # #-    # #  #        ######## ####    #  #",
"  #       #   ########## #.. ....#  # ########        #  ##   ## #",
"  #  -.   #####          ####...##  #    .  .#   ..   #        # #",
"  #             ######      #####   #####.####        #######  # #",
"  #  -    #######....####   ......      #.#       .     #   ## # #",
"  #########             ##### ###########.###############    ### #",
"                                         .                       #",
//
" D D     #-..........#     #   #   #   #                         #",
" # #     #####.#####.# #   #   #   # # #############D########### #",
" # #####  #.-#.#~###.# #   #   #   # # ###      ....    #  #   # #",
" # .   # #D###.......# #   #   #   # # #        . . -.. #. #.# # #",
" # . - # ##. #.####### #   #   #   # # ##################    #   #",
"D####### #  ##.        #       D     #        .              # # #",
". D D -# #   ################################################### #",
"  ###### ##   .                                             .    #",
"  #    D    ###  ###D###D####### ###D###D####### ###D###D####### #",
"  # ######  # # .#    .# #.    # #     # #     # #     # # .   # #",
"  ###   -#  # # .#. - .# #     # #...- # # ..  # #  -..# # .   # #",
"DD#      #  # #  #.   .# #     # #     # #     # # .. .# #     # #",
".######  #    #  #     # #.....# #     # #     # # !   # #     # #",
" #      #######  ####### ### ###D####### ### ###D####### ### ###D#",
" # ...                                       ..                  #"
};

static void print_map(int k);
static void squish_map();
static void unsquish_map();
void main()
{
  //  print_map(1);
  squish_map();
  unsquish_map();
}

// print the kth map
static void print_map(int k)
{
  int i,j;
  for (j = 0 ; j < CAN_COL + 2 ; j++) {
    printf("#");
  }
  printf("\n");

  for (i = 0 ; i < CAN_ROW ; i++) {
    printf("#");
    for (j = 0 ; j < CAN_COL ; j++) {
      printf("%c", canned[i+k*CAN_ROW][j]);
    }
    printf("#");
    printf("\n");
  }

  for (j = 0 ; j < CAN_COL + 2 ; j++) {
    printf("#");
  }
  printf("\n");
}

char unconvert[7] = " !#-.D~";
static int convert(char c) {
  int x = 0;
  switch(c) {
  case ' ':
    x=0; break;
  case '!':
    x=1; break;
  case '#':
    x=2; break;
  case '-':
    x=3; break;
  case '.':
    x=4; break;
  case 'D':
    x=5; break;
  case '~':
    x=6; break;
  }
  return x;
}

// print the kth map
static void squish_map()
{
  int i,j,x,y;
  char c, d;
  FILE *fp = fopen("foo.out", "w");
  fprintf(fp,"char squish[%d][%d] = {\n", CAN_ROW*CAN_LEV, CAN_COL/2);
  for (i = 0 ; i < CAN_ROW*CAN_LEV ; i++) {
    fprintf(fp," {");
    for (j = 0 ; j < CAN_COL ; j++) {
      c = canned[i][j++];
      d = canned[i][j];
      x = convert(c);
      y = convert(d);
      if (j < CAN_COL-1)	fprintf(fp,"%d, ", x*16 + y);
      else                      fprintf(fp,"%d", x*16 + y);
    }
    if (i < (CAN_ROW*CAN_LEV)-1)    fprintf(fp,"},\n");
    else                  fprintf(fp,"}\n");
  }
  fprintf(fp,"};\n");
}


static void unsquish_map()
{
  int i,j;
  char x,y;
  char c, d;
  for (i = 0 ; i < CAN_ROW*CAN_LEV ; i++) {
    for (j = 0 ; j < CAN_COL/2 ; j++) {
      //      c = unconvert[x];
      //      d = unconvert[y];
      //      printf("%x %x", x, y);
      //      printf("(%x ", squish[i][j]);
      x = (squish[i][j] & 0xF0) >> 4; // high 4
      y = squish[i][j] & 0x0F; // low  4
      //      printf("%x %x) ", x, y);
      //      printf("%c%c) ", unconvert[x], unconvert[y]);
      printf("%c%c", unconvert[x], unconvert[y]);
    }
    printf("\n");
    //    break;
  }
}
